{% extends "base.html" %}
{% block title %}Letter Preview{% endblock %}

{% block content %}
<style>
.page {
    display: flex;
    justify-content: center;
    margin-top: 30px;
}

.paper {
    width: 820px;
    background: white;
    padding: 60px;
    border-radius: 8px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    font-family: "Times New Roman", serif;
    line-height: 1.7;
}

.paper:focus {
    outline: none;
}

.actions {
    max-width: 820px;
    margin: 20px auto;
}

.btn-primary {
    width: 100%;
    padding: 12px;
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    cursor: pointer;
}

.btn-secondary {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    background: #f3f4f6;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    cursor: pointer;
}
</style>

<div class="page">
    <div class="paper" contenteditable="true">

        <!-- HEADER 
        <p>
            <b>CodexConquer</b><br>
            <!--123 Business Avenue, Suite 100<br>
            New York, NY 10001<br>
            Phone: (555) 123-4567 | www.codexconquer.com
        </p>-->
        <!-- HEADER -->
<div style="display:flex; align-items:center; gap:15px; margin-bottom:20px;">

    <img
  src="{% if logo_path %}{{ logo_path }}{% else %}{{ url_for('static', filename='images/logo.png') }}{% endif %}"
  style="height:60px;"
>



    <div>
        <div style="font-size:26px; font-weight:bold; color:#1f4fd8;">
            CODEXCONQUER
        </div>
        <div style="font-size:14px;">
            www.codexconquer.com
        </div>
    </div>

</div>

<hr style="border:1px solid #2563eb; margin:15px 0 30px;">

<!-- ðŸ‘‡ ADD THIS WRAPPER -->
<div style="clear:both;"></div>


        <!-- TITLE -->
        <p style="text-align:center; font-weight:bold; font-size:18px;margin-top:20px;">
            {{ title }}
        </p>

        <!-- DATE -->
        <p><b>Date:</b> {{ today }}</p>

        <!-- GREETING -->
        <p>Dear {{ name }},</p>

        <!-- BODY -->
        <!--<div id="letterBody">

        {% if letter_type == "Relieving Letter" %}

            <p>
                This is to formally acknowledge that you have completed your Internship
                tenure with <strong>CodeXConquer</strong> from
                <strong>{{ joining_date }}</strong> to
                <strong>{{ relieving_date }}</strong>,
                as a <strong>{{ designation }}</strong>.
            </p>

            <p>
                During this period, you demonstrated professionalism, willingness to learn,
                and a positive work attitude. Your contributions to assigned tasks and projects
                were appreciated, and you maintained the standards expected from an
                employee in our organization.
            </p>

            <p>
                We appreciate your efforts and commitment during your internship.
                We wish you the very best in your future academic and professional endeavors.
            </p>

            <p>
                If you need any documents or verification regarding your internship,
                please do not hesitate to contact us.
            </p>

        {% else %}

            {% if draft_content %}
                {{ draft_content }}
            {% else %}
                {{ body }}
            {% endif %}

        {% endif %}

        </div>-->
        <div id="letterBody">

{% if draft_content %}
    {{ draft_content | safe }}

{% elif body %}
    {{ body | safe }}

{% else %}

    {% if letter_type == "Relieving Letter" %}
        <p>
            This is to formally acknowledge that you have completed your Internship
            tenure with <strong>CodeXConquer</strong> from
            <strong>{{ joining_date }}</strong> to
            <strong>{{ relieving_date }}</strong>,
            as a <strong>{{ designation }}</strong>.
        </p>

        <p>
            During this period, you demonstrated professionalism, willingness to learn,
            and a positive work attitude.
        </p>

        <p>
            We appreciate your efforts and commitment during your internship.
        </p>

        <p>
            If you need any documents or verification, please contact us.
        </p>

        {% elif letter_type == "Termination Letter" %}
            <p>
This letter is to formally inform you that your employment with codexconquer is terminated effective {{ today }}.
</p>
<p>This decision has been taken after careful consideration and is based on performance issues / violation of company policy / organizational restructuring, as discussed with you earlier.</p>
<p>
You are requested to complete all exit formalities and hand over company property, documents, and access credentials to HR / Reporting Manager on or before your last working day.
</p>
<p>Your final settlement, including any dues or recoveries as per company policy, will be processed and communicated to you separately.</p>
<p>We thank you for your contributions to the company and wish you all the best in your future endeavors.</p>


{% elif letter_type == "Appreciation Letter" %}
<P>I am pleased to write this letter of recommendation for <strong>{{name}}</strong>, who successfully completed their internship with <strong>Codexconquer</strong> as a {{ designation }} from {{ joining_date }} to {{relieving_date}}.</P>

<P>During the internship period, <strong>{{name}}</strong> consistently demonstrated a strong work ethic, eagerness to learn, and the ability to apply theoretical knowledge to practical tasks. They were actively involved in software development and completed all assigned tasks with professionalism and dedication.
</P>
<P>One of their key strengths is problem-solving, communication skills, teamwork, technical skills . <strong>{{name}}</strong> worked well both independently and as part of a team, showed a positive attitude toward feedback, and was always willing to take on new challenges.
</P>
<P>Based on their performance, I am confident that <strong>{{ name }}</strong> will be a valuable asset to any organization or academic program they chooses to pursue. I strongly recommend them without any reservation.
</P>
    {% endif %}

{% endif %}

</div>


        <br>

        <!-- FOOTER -->
        <p>
            Sincerely,<br><br>
            <b>Human Resources Department</b><br>
            CodexConquer
        </p>

    </div>
</div>

<div class="actions">

    <!-- FINAL GENERATE -->
    <form method="post"
          action="{{ url_for('finalize_generic_letter') }}"
          onsubmit="setFinalContent()">

        <input type="hidden" name="emp_id" value="{{ emp_id }}">
        <input type="hidden" name="letter_type" value="{{ letter_type }}">
        <input type="hidden" name="content" id="finalContent">
        <input type="hidden" name="draft_id" value="{{ draft_id }}">

        <button class="btn-primary">
            Confirm & Generate Letter
        </button>
    </form>

    <!-- SAVE DRAFT -->
    <form id="draftForm" method="post">
        <input type="hidden" name="emp_id" value="{{ emp_id }}">
        <input type="hidden" name="letter_type" value="{{ letter_type }}">
        <input type="hidden" name="content" id="draftContent">
        <input type="hidden" name="draft_id" value="{{ draft_id }}">

        <button type="submit" class="btn-secondary">
            ðŸ’¾ Save as Draft
        </button>
    </form>
</div>

<!--<script>
function setFinalContent() {
    document.getElementById("finalContent").value =
        document.getElementById("letterBody").innerText;
}

document.getElementById("draftForm").addEventListener("submit", function(e) {
    e.preventDefault();
    document.getElementById("draftContent").value =
        document.getElementById("letterBody").innerText;

    fetch("{{ url_for('save_draft') }}", {
        method: "POST",
        body: new FormData(this)
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            alert("Draft saved successfully");
        }
    });
});
</script>-->
<script>
function setFinalContent() {
    document.getElementById("finalContent").value =
        document.getElementById("letterBody").innerHTML;
}

document.getElementById("draftForm").addEventListener("submit", function(e) {
    e.preventDefault();

    document.getElementById("draftContent").value =
        document.getElementById("letterBody").innerHTML;

    fetch("{{ url_for('save_draft') }}", {
        method: "POST",
        body: new FormData(this)
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            alert("Draft saved successfully");
        }
    });
});
</script>


{% endblock %}
